function doHighlight(t,e,a,s){a&&s||(a="<font style='color:blue; background-color:yellow;' class='black-box-found-text'>",s="</font>");for(var r="",n=-1,o=e.toLowerCase(),c=t.toLowerCase();t.length>0;)(n=c.indexOf(o,n+1))<0?(r+=t,t=""):t.lastIndexOf(">",n)>=t.lastIndexOf("<",n)&&c.lastIndexOf("/script>",n)>=c.lastIndexOf("<script",n)&&(r+=t.substring(0,n)+a+t.substr(n,e.length)+s,c=(t=t.substr(n+e.length)).toLowerCase(),n=-1);return r}function highlightSearchTerms(t,e,a,s,r){if(searchArray=e?[t]:t.split(" "),!document.body||void 0===document.body.innerHTML)return a&&alert("Sorry, for some reason the text of this page is unavailable. Searching will not work."),!1;for(var n=document.body.innerHTML,o=0;o<searchArray.length;o++)n=doHighlight(n,searchArray[o],s,r);return document.body.innerHTML=n,$(".black-box-found-text").get(0).scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),!0}function closeSearch(){$(".black-box-search-page-holder").off(),$(".black-box-search-page-holder").remove()}function openSearch(t){if(0===$(".black-box-search-page-holder").length){var e=$(`\n\t\t\t<div class="search-holder black-box-search-page-holder">\n\t\t\t\t<div class="search-container">\n\t\t\t\t\t<div class="search-bar">\n\t\t\t\t\t\t<div class="search-top">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\t\t\t\tx="0px"\n\t\t\t\t\t\t\t\ty="0px"\n\t\t\t\t\t\t\t\twidth="14"\n\t\t\t\t\t\t\t\theight="14"\n\t\t\t\t\t\t\t\tviewBox="0 0 172 172"\n\t\t\t\t\t\t\t\tstyle="fill: #000000"\n\t\t\t\t\t\t\t\tclass="search-icon"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<g\n\t\t\t\t\t\t\t\t\tfill="none"\n\t\t\t\t\t\t\t\t\tfill-rule="nonzero"\n\t\t\t\t\t\t\t\t\tstroke="none"\n\t\t\t\t\t\t\t\t\tstroke-width="1"\n\t\t\t\t\t\t\t\t\tstroke-linecap="butt"\n\t\t\t\t\t\t\t\t\tstroke-linejoin="miter"\n\t\t\t\t\t\t\t\t\tstroke-miterlimit="10"\n\t\t\t\t\t\t\t\t\tstroke-dasharray=""\n\t\t\t\t\t\t\t\t\tstroke-dashoffset="0"\n\t\t\t\t\t\t\t\t\tfont-family="none"\n\t\t\t\t\t\t\t\t\tfont-weight="none"\n\t\t\t\t\t\t\t\t\tfont-size="none"\n\t\t\t\t\t\t\t\t\ttext-anchor="none"\n\t\t\t\t\t\t\t\t\tstyle="mix-blend-mode: normal"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td="M0,172v-172h172v172z"\n\t\t\t\t\t\t\t\t\t\tfill="none"\n\t\t\t\t\t\t\t\t\t></path>\n\t\t\t\t\t\t\t\t\t<g fill="#c1c9d2">\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td="M72.24,10.32c-32.26344,0 -58.48,26.21656 -58.48,58.48c0,32.26344 26.21656,58.48 58.48,58.48c12.76563,0 24.56375,-4.11187 34.185,-11.0725l45.2575,45.15l9.675,-9.675l-44.72,-44.8275c8.78813,-10.23937 14.0825,-23.52906 14.0825,-38.055c0,-32.26344 -26.21656,-58.48 -58.48,-58.48zM72.24,17.2c28.54125,0 51.6,23.05875 51.6,51.6c0,28.54125 -23.05875,51.6 -51.6,51.6c-28.54125,0 -51.6,-23.05875 -51.6,-51.6c0,-28.54125 23.05875,-51.6 51.6,-51.6z"\n\t\t\t\t\t\t\t\t\t\t></path>\n\t\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tclass="search-input"\n\t\t\t\t\t\t\t\tplaceholder="Go to"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<img class="black-box-loader" src="${chrome.extension.getURL("images/loader.svg")}" alt="loader">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="search-middle">\n\t\t\t\t\t\t\t<div class="title-strip-holder">\n\t\t\t\t\t\t\t\t<div class="title">Recently viewed</div>\n\t\t\t\t\t\t\t\t<div class="filter-options hide">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="search-result-items"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="search-bottom">\n\t\t\t\t\t\t\t<div class="search-text">\n\t\t\t\t\t\t\t\tPress <span class="command">CMD-J</span>or<span class="command">Alt-O</span> to\n\t\t\t\t\t\t\t\tuse the BLACKBOX deep search.\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);$("body").prepend(e),$(".black-box-search-page-holder .search-input").focus(),void 0!==t.data&&($(".black-box-search-page-holder .search-input").val(t.data),searchQuery(t.data),savedTerm=t.data),$(".black-box-search-page-holder").on("click",(function(t){$(t.target).hasClass("black-box-search-page-holder")&&closeSearch()})),$(".black-box-search-page-holder .filter").on("click",(function(){$(".black-box-search-page-holder .filter").removeClass("active"),$(this).addClass("active"),$(this).hasClass("videos")?searchQuery(`${savedTerm}`,"videos"):searchQuery(savedTerm)})),$(document).on("click",".black-box-search-page-holder .search-item",(function(){$(".black-box-found-text").contents().unwrap();const t=$(this).find(".search-title").text().trim();closeSearch(),highlightSearchTerms(t,!0)})),chrome.storage.local.get(["searched"],(function(t){void 0!==t.searched?t.searched.forEach((t=>{$(".black-box-search-page-holder .search-middle .search-result-items").append($.parseHTML(t))})):$(".black-box-search-page-holder .search-middle").addClass("hide")})),$(".black-box-search-page-holder .search-input").on("keydown",(function(t){const e=$(this).val();13===t.keyCode&&""!==e&&(searchQuery(e),savedTerm=e)}))}else closeSearch()}function searchQuery(t,e=""){$(".black-box-search-page-holder .search-top .black-box-loader").css("visibility","visible"),t||(t=savedTerm);var a=htmlText(document.body.innerHTML);chrome.runtime.sendMessage({message:"search-web",data:t,filter:e,fullText:a})}function htmlText(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<style([\s\S]*?)<\/style>/gi,"")).replace(/<script([\s\S]*?)<\/script>/gi,"")).replace(/<\/div>/gi,"\n")).replace(/<\/li>/gi,"\n")).replace(/<li>/gi,"  *  ")).replace(/<\/ul>/gi,"\n")).replace(/<\/p>/gi,"\n")).replace(/<br\s*[\/]?>/gi,"\n")).replace(/<[^>]+>/gi,"")).split("\n").join(" ")).split("\t").join(" ")}!function(){var t=document.createElement("style");t.type="text/css",t.textContent='@font-face { font-family: Roboto; src: url("'+chrome.extension.getURL("css/Roboto-Regular.ttf")+'"); }',document.head.appendChild(t),$(document).on("keydown",(function(t){27===t.keyCode&&$(".black-box-search-page-holder")&&closeSearch()}))}(),chrome.runtime.onMessage.addListener(((t,e,a)=>{if("search"===t.message)openSearch(t);else if("show-search-results"===t.message){$(".black-box-search-page-holder .search-middle .title").text("Results"),$(".black-box-search-page-holder .search-middle .search-result-items").empty(),$(".black-box-search-page-holder .search-top .black-box-loader").css("visibility","hidden"),"videos"!==t.filter&&($(".black-box-search-page-holder .filter").removeClass("active"),$(".black-box-search-page-holder .filter.all").addClass("active")),$(".black-box-search-page-holder .search-middle").removeClass("hide"),$(".black-box-search-page-holder .filter-options").removeClass("hide"),t.data.split(";").forEach((t=>{var e;0!=t.length&&(e=$(`\n\t\t\t\t\t<a target="_blank" class="search-item">\n\t\t\t\t\t\t<div class="search-title">${t}</div>\n\t\t\t\t\t</a>\n\t\t\t\t`),$(".black-box-search-page-holder .search-middle .search-result-items").append(e))}))}return!0}));